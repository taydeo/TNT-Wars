package com.rast.tntwars.systems;

import java.util.Random;

import org.bukkit.Bukkit;
import org.bukkit.entity.Player;

import com.rast.tntwars.TNTWarsMain;

/**
 * This class contains methods to start the game.
 * 
 * @author Raster556
 */

public class GameInitializer {

	public boolean gameStarted = false;
	
	public void addPlayerToGame (Player player) {
		int teamOneCount = TNTWarsMain.playerGroupManager.teamOneCount;
		int teamTwoCount = TNTWarsMain.playerGroupManager.teamTwoCount;
		
		// Balance the way we put players in teams and do a straw pull when the teams are equally full
		if (teamOneCount < teamTwoCount) {
			TNTWarsMain.playerGroupManager.addToGroup(player, "teamOne");
			teamOneJoin(player);
		} else if (teamOneCount > teamTwoCount) {
			TNTWarsMain.playerGroupManager.addToGroup(player, "teamTwo");
			PlayerTeleportManager.teleportTeamTwoIsland(player, true);
			teamTwoJoin(player);
		} else {
			Random rand = new Random(System.currentTimeMillis());
			boolean strawPull = rand.nextBoolean();
			
			if (strawPull) {
				TNTWarsMain.playerGroupManager.addToGroup(player, "teamOne");
				PlayerTeleportManager.teleportTeamOneIsland(player, true);
				teamOneJoin(player);
			} else {
				TNTWarsMain.playerGroupManager.addToGroup(player, "teamTwo");
				PlayerTeleportManager.teleportTeamTwoIsland(player, true);
				teamTwoJoin(player);
			}
			
		}
		
	}
	
	private void teamOneJoin(Player player) {
		String name = player.getName();
		if (gameStarted) {
			PlayerTeleportManager.teleportTeamOneIsland(player, true);
		} else {
			PlayerTeleportManager.teleportTeamOneWaitRoom(player, true);
		}
		Bukkit.broadcastMessage(TNTWarsMain.configEngine.teamOneColor + name + " has joined the " + TNTWarsMain.configEngine.teamOneName + " team!");
	}
	
	private void teamTwoJoin (Player player) {
		String name = player.getName();
		if (gameStarted) {
			PlayerTeleportManager.teleportTeamTwoIsland(player, true);
		} else {
			PlayerTeleportManager.teleportTeamTwoWaitRoom(player, true);
		}
		Bukkit.broadcastMessage(TNTWarsMain.configEngine.teamTwoColor + name + " has joined the " + TNTWarsMain.configEngine.teamTwoName + " team!");
	}
	
}
